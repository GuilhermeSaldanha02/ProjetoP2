<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luxo - Admin Login</title>
    <link rel="shortcut icon" href="images/barco2.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/default.css" />
  </head>

  <body>
    <div class="page">
      <header>
        <div id="title">
          <img src="images/barco1.png" alt="ícone de barco" />
          <div class="headtitle">
            <h1>Luxo</h1>
            <h2>Aluguel de iates</h2>
          </div>
        </div>
        </header>

      <main>
        <div class="pagtitle">
          <div class="bgtitle"></div>
          <h2>Login Administrativo</h2>
        </div>

        <form id="form-login">
          <div class="entry">
            <label for="admin-email">E-mail</label>
            <input type="email" id="admin-email" required />
          </div>

          <div class="entry">
            <label for="admin-senha">Senha</label>
            <input type="password" id="admin-senha" required />
          </div>

          <p id="erro-login" style="color: red; text-align: center; display: none;">
            E-mail e Senha inválidos
          </p>
        </form>

        <div class="buttons">
          <button class="button" id="btn-login">Entrar</button>
        </div>
      </main>
    </div>

    <footer>
      <p>© 2023 por Luxo aluguel de iates</p>
    </footer>

    <script src="js/jquery-3.6.4.min.js"></script>
    <script src="js/api.js?v=2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      $(document).ready(function() {
        sessionStorage.removeItem('isLogged');

        $('#btn-login').on('click', function(e) {
          e.preventDefault();
          $('#erro-login').hide();

          var emailAdmin = $('#admin-email').val();
          var senhaAdmin = $('#admin-senha').val();
          
          if(!emailAdmin || !senhaAdmin) return;

          var objLoginSenha = { 
            email: emailAdmin, 
            senha: senhaAdmin 
          };

          var $btn = $(this); 
          $btn.prop('disabled', true).text('Verificando...');

          validarUsuario(objLoginSenha) 
            .done(function(ehValido) { 
                // A API retorna true (booleano) ou "true" (string) 
                if (ehValido === true || ehValido === "true") { 
                    Swal.fire({ 
                        title: 'Bem-vindo!', 
                        text: 'Login realizado com sucesso.', 
                        icon: 'success', 
                        timer: 1500, 
                        showConfirmButton: false 
                    }).then(() => { 
                        sessionStorage.setItem('isLogged', 'true'); 
                        window.location.href = 'mensagens.html'; 
                    }); 
                } else { 
                    $('#erro-login').show(); 
                    $btn.prop('disabled', false).text('Entrar'); 
                } 
            }) 
            .fail(function() { 
                Swal.fire('Erro', 'Falha na conexão com o servidor.', 'error'); 
                $btn.prop('disabled', false).text('Entrar'); 
            }); 
        });
      });
    </script>
    </body>
 </html>